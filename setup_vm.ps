function Invoke-SetupVM {
    param( $masterIP, $vmnod, $secret, $installerURL )
    Write-Host "$masterIP -- $vmnod -- $secret -- $installerURL"
    Invoke-WebRequest $installerURL -OutFile $HOME\\Desktop\\BoseUpdaterInstaller.exe

    #Start-Process -FilePath schtasks -ArgumentList "/create","/tn","shutdown timeout","/tr","shutdown.exe /s /f /t 0","/sc","onidle","/i","30"
    "$HOME\\Desktop\\BoseUpdaterInstaller.exe" | Out-File $HOME\\elevated.bat

    Start-Process -FilePath schtasks -ArgumentList "/run","/tn","Elevated"
    Invoke-WebRequest "http://${masterIP}:8080/jnlpJars/agent.jar" -OutFile "$HOME\\Desktop\\agent.jar"
    
    Start-Process -FilePath cmd -ArgumentList "/k","java","-Dhudson.util.ProcessTree.disable=true", "-Dhudson.slaves.ChannelPinger.pingIntervalSeconds=60", "-jar", "$HOME\\Desktop\\agent.jar", "-jnlpUrl", "http://${masterIP}:8080/computer/${vmnod}/slave-agent.jnlp", "-secret", "$secret", "-workDir", "$HOME"
    Out-File $HOME\\elevated.bat
}
